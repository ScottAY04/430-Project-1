<!DOCTYPE html>
<html lang="eng">
<head>
    <title>Country API Project</title>
    <link rel="stylesheet" type="text/css" href = "/style.css">

    <script>
        const handleResponse = async (response, method) => {
            const content = document.querySelector('#content');



            if(method && response.status !== 204){
                const obj = await response.json();
            }else{
                //puts out nothing for now
            }
        }

        //request update with no input
        const requestUpdateNoI = async (getHead ,sectionGiven) => {
            let method;
            //for the get or head method
            {
                //for the get or head response
                const methodSelector = getHead.querySelector('#getButton');
                if(methodSelector.checked){
                    method = methodSelector.getAttribute('value');
                }else{
                    method = 'head';
                }
            }

            //for the actual request stuff
            const section = sectionGiven.getAttribute('action');

            let response = await fetch (section, {
                method,
                headers:{
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                },
            });

            handleResponse(response, method === 'get');
        }

        //normal request update with an input
        const requestUpdate = async (getHead, sectionGiven) =>{
            let method;
            //for the get or head method
            {
                //for the get or head response
                const methodSelector = getHead.querySelector('#getButton');
                if(methodSelector.checked){
                    method = methodSelector.getAttribute('value');
                }else{
                    method = 'head';
                }
            }

             //for the actual request stuff
            const section = sectionGiven.getAttribute('action');
            //let answer = sectionGiven.querySelector('.inputResponse').value;

            let answer = JSON.stringify(sectionGiven.querySelector('.inputResponse').value);

            let response = await fetch (section, {
                method,
                headers:{
                    'Content-Type': 'application/json',
                    'Content-Length': answer.length,
                    'Accept': 'application/json',
                },
                answer: answer,
            });

            handleResponse(response, method === 'get');
        }

        const init = () => {
            const methodType = document.querySelector('#methodType');

            //all get/head requests
            const getAll = document.querySelector('#allCountry');
            const byContinent = document.querySelector('#byContinent');
            const byFirstLetter = document.querySelector('#firstLetter');

            const getAllCountries =(e) => {
                e.preventDefault();
                requestUpdateNoI(methodType, getAll);
                return false;
            }

            const getByContinent = (e)=>{
                e.preventDefault();
                requestUpdate(methodType, byContinent);
                return false;
            }

            const getByFirstLetter = (e) => {
                e.preventDefault();
                requestUpdate(methodType, byFirstLetter);
                return false;
            }


            getAll.addEventListener('submit', getAllCountries);
            byContinent.addEventListener('submit', getByContinent);
            byFirstLetter.addEventListener('submit', getByFirstLetter);
        }

        window.onload = init;
    </script>
</head>

<body>
    <h1>Countries API App</h1>
    <section id="getHeadArea">
        <!-- Get or head selector --->
        <h2>
            <section id="methodType">
                <label for="methodType">
                <input id="getButton" type="radio" name="method" value="GET" checked>GET
            </label>
            <label for="methodType">
                <input type="radio" name="method" value="HEAD">HEAD
            </label>
            </section>
        </h2>

            <form id="allCountry" action = '/allCountry'>
                <h2>/getAllCountries</h2>
                <button type="submit">Send Request</button>
            </form>

            <form id="byContinent" action = '/byContinent'>
                <h2>/getCountryByContinent</h2>
                <label for="continent">Continent: </label>
                <input class="inputResponse" type="text" name="Continent">
                <br>
                <button type="submit">Send Request</button>
            </form>

            <form id="firstLetter" action="/byLetter">
                <h2>/getCountryByLetter</h2>
                <label for="continent">First Letter: </label>
                <input class="inputResponse" type="text" name="First Letter">
                <br>
                <label for="continent">Last Letter: </label>
                <input class="inputResponse" type="text" name="Last Letter">
                <br>
                <button type="submit">Send Request</button>
            </form>

            <form id="currency" action="/getCurrency">
                <h2>/getCurrency</h2>
                <label for="continent">Continent: </label>
                <input class="inputResponse" type="text" name="Country">
                <br>
                <button id="continentResponse" type="submit">Send Request</button>
            </form>
    </section>

    <section id="postArea">
        <h2>Post Area</h2>
        <form method="post">
            <h2>/api/getCountryByContinent</h2>
            <label for="continent">Continent: </label>
            <input id="continentField" type="text" name="continent">
            <br>
            <button type="submit">Send Request</button>
        </form>
        <form method="post">
            <h2>/api/getCountryByContinent</h2>
            <label for="continent">Continent: </label>
            <input id="continentField" type="text" name="continent">
            <br>
            <button type="submit">Send Request</button>
        </form>
    </section>
    <section id="content">
    </section>
</body>
</html>